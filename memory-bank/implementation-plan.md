# VS Code MyBatis ERå›¾ç”Ÿæˆæ’ä»¶ - è¯¦ç»†å®ç°è®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

åŸºäºå®Œæˆçš„åˆ›æ„è®¾è®¡é˜¶æ®µï¼Œæœ¬æ–‡æ¡£è¯¦ç»†è§„åˆ’VS Code MyBatis ERå›¾ç”Ÿæˆæ’ä»¶çš„å®ç°è·¯å¾„ã€‚é¡¹ç›®é‡‡ç”¨**æ™ºèƒ½åˆ†å±‚å¼‚æ­¥æ¶æ„**ï¼Œå®ç°æ¯”åŸIDEAæ’ä»¶æ›´ä¼˜å¼‚çš„æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

| ç›®æ ‡ç»´åº¦ | æŒ‡æ ‡ | å½“å‰çŠ¶æ€ |
|----------|------|----------|
| **åŠŸèƒ½å®Œæ•´æ€§** | æ”¯æŒMyBatis-Pluså…¨éƒ¨ä¸»æµæ³¨è§£ | ğŸ“‹ å¾…å®ç° |
| **è§£æå‡†ç¡®æ€§** | 90%ä»¥ä¸Šå®ä½“è¯†åˆ«ï¼Œ80%ä»¥ä¸Šå…³ç³»æ¨æ–­ | ğŸ“‹ å¾…å®ç° |
| **æ€§èƒ½æŒ‡æ ‡** | 1000å®ä½“<10ç§’ï¼Œå¢é‡æ›´æ–°<1ç§’ | ğŸ“‹ å¾…å®ç° |
| **ç”¨æˆ·ä½“éªŒ** | ç°ä»£åŒ–ç•Œé¢ï¼Œæµç•…äº¤äº’ | ğŸ“‹ å¾…å®ç° |

## ğŸš€ å®ç°é˜¶æ®µè¯¦ç»†æ‹†åˆ†

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒæ¡†æ¶æ­å»º (ç¬¬1-2å‘¨)

#### 1.1 é¡¹ç›®åˆå§‹åŒ– (2å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] åˆ›å»ºVS Codeæ‰©å±•é¡¹ç›®ç»“æ„
- [ ] é…ç½®TypeScript + webpack + esbuildæ„å»ºç¯å¢ƒ
- [ ] è®¾ç½®package.jsonå’Œæ‰©å±•é…ç½®
- [ ] é…ç½®å¼€å‘ç¯å¢ƒå’Œè°ƒè¯•è®¾ç½®

**è¾“å‡ºç‰©**:
```
vscode-mybatis-er/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts           # æ‰©å±•å…¥å£
â”‚   â”œâ”€â”€ commands/             # å‘½ä»¤å¤„ç†
â”‚   â”œâ”€â”€ workers/              # Workerçº¿ç¨‹
â”‚   â”œâ”€â”€ parsers/              # è§£æå™¨
â”‚   â”œâ”€â”€ ui/                   # UIç»„ä»¶
â”‚   â””â”€â”€ utils/                # å·¥å…·å‡½æ•°
â”œâ”€â”€ package.json              # æ‰©å±•é…ç½®
â”œâ”€â”€ tsconfig.json             # TSé…ç½®
â”œâ”€â”€ webpack.config.js         # æ„å»ºé…ç½®
â””â”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
```

#### 1.2 Extensionå…¥å£å’Œå‘½ä»¤ç³»ç»Ÿ (2å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°extension.tsä¸»å…¥å£
- [ ] æ³¨å†Œæ ¸å¿ƒå‘½ä»¤ (ç”ŸæˆERå›¾ã€åˆ·æ–°ã€å¯¼å‡ºç­‰)
- [ ] é…ç½®å‘½ä»¤é¢æ¿é›†æˆ
- [ ] å®ç°åŸºç¡€çš„çŠ¶æ€ç®¡ç†

**æŠ€æœ¯è¦ç‚¹**:
```typescript
// extension.ts
export function activate(context: vscode.ExtensionContext) {
  // æ³¨å†Œå‘½ä»¤
  const generateCommand = vscode.commands.registerCommand(
    'mybatis-er.generate',
    () => generateERDiagram()
  );
  
  context.subscriptions.push(generateCommand);
}
```

#### 1.3 Workerçº¿ç¨‹é€šä¿¡æ¡†æ¶ (3å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è®¾è®¡Workeræ¶ˆæ¯åè®®
- [ ] å®ç°WorkerManagerç®¡ç†å™¨
- [ ] åˆ›å»ºåŸºç¡€Workeræ¨¡æ¿
- [ ] å®ç°é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

**æ¶æ„è®¾è®¡**:
```typescript
interface WorkerMessage {
  id: string;
  type: 'PARSE_ENTITY' | 'PARSE_XML' | 'INFER_RELATIONS';
  payload: any;
  timestamp: number;
}

class WorkerManager {
  createWorker(type: WorkerType): Worker;
  sendTask(worker: Worker, task: Task): Promise<Result>;
  handleWorkerMessage(message: WorkerMessage): void;
}
```

#### 1.4 æ–‡ä»¶æ‰«æå’Œç›‘å¬ç³»ç»Ÿ (2å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°å·¥ä½œç©ºé—´æ–‡ä»¶æ‰«æ
- [ ] åˆ›å»ºæ–‡ä»¶ç±»å‹è¿‡æ»¤å™¨
- [ ] å®ç°æ–‡ä»¶å˜æ›´ç›‘å¬
- [ ] è®¾è®¡å¢é‡æ›´æ–°æœºåˆ¶

### é˜¶æ®µäºŒï¼šæ™ºèƒ½è§£æå¼•æ“ (ç¬¬3-4å‘¨)

#### 2.1 Javaå®ä½“è§£æå™¨ (SmartJavaParser) (4å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°åŸºç¡€Javaæ–‡ä»¶è§£æ
- [ ] MyBatis-Plusæ³¨è§£è¯†åˆ«
  - [ ] @TableName è§£æ
  - [ ] @TableId ä¸»é”®è¯†åˆ«
  - [ ] @TableField å­—æ®µè§£æ
- [ ] å­—æ®µç±»å‹æ¨æ–­å’Œè½¬æ¢
- [ ] æ··åˆè§£æç­–ç•¥å®ç°

**æ ¸å¿ƒä»£ç ç»“æ„**:
```typescript
class SmartJavaParser {
  parseEntity(content: string): EntityInfo;
  extractAnnotations(content: string): AnnotationInfo[];
  inferFieldTypes(content: string): FieldInfo[];
  
  // æ··åˆè§£æç­–ç•¥
  autoSelectStrategy(fileContent: string): 'regex' | 'ast' | 'hybrid';
}
```

#### 2.2 XMLæ˜ å°„è§£æå™¨ (OptimizedXMLParser) (5å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°æ™ºèƒ½è§£æç­–ç•¥é€‰æ‹©
- [ ] DOMè§£æå™¨ä¼˜åŒ–
- [ ] SAXæµå¼è§£æå™¨
- [ ] ResultMapå…³ç³»æå–
- [ ] Association/Collectionè§£æ
- [ ] SQLè¯­å¥ä¸­çš„JOINåˆ†æ

**è§£æç›®æ ‡**:
- è§£æ`<resultMap>`ä¸­çš„å…³è”å…³ç³»
- æå–`<association>`å’Œ`<collection>`æ ‡ç­¾
- åˆ†æSQLä¸­çš„JOINè¯­å¥
- å¤„ç†åŠ¨æ€SQLæ¡ä»¶

#### 2.3 æµå¼å¤„ç†ç®¡é“ (2å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°æ–‡ä»¶æµå¼è¯»å–
- [ ] è®¾è®¡æ•°æ®ç®¡é“å¤„ç†
- [ ] å®ç°èƒŒå‹æ§åˆ¶
- [ ] é”™è¯¯æ¢å¤æœºåˆ¶

### é˜¶æ®µä¸‰ï¼šæ™ºèƒ½å…³ç³»æ¨æ–­å¼•æ“ (ç¬¬5å‘¨)

#### 3.1 å››ç­–ç•¥æ¨æ–­ç³»ç»Ÿ (4å¤©)

**3.1.1 å‘½åçº¦å®šæ¨æ–­ç­–ç•¥ (1å¤©)**
```typescript
class NamingInferenceStrategy {
  private patterns = [
    { pattern: /^(.+)_id$/i, relation: 'belongs_to', confidence: 0.8 },
    { pattern: /^(.+)_key$/i, relation: 'belongs_to', confidence: 0.7 },
    { pattern: /^fk_(.+)$/i, relation: 'belongs_to', confidence: 0.9 }
  ];
  
  async infer(entities: Entity[]): Promise<InferenceResult[]>;
}
```

**3.1.2 XMLè¯­ä¹‰æ¨æ–­ç­–ç•¥ (1å¤©)**
- è§£æ`<association>`æ ‡ç­¾å…³ç³»
- åˆ†æJOINè¯­å¥æ¨¡å¼
- æå–å¤–é”®çº¦æŸä¿¡æ¯

**3.1.3 æ³¨è§£æ¨æ–­ç­–ç•¥ (1å¤©)**
- å¤„ç†`@One`ã€`@Many`æ³¨è§£
- è§£æ`@Result`æ˜ å°„å…³ç³»
- åˆ†æçº§è”å…³ç³»

**3.1.4 è¯­ä¹‰åˆ†æç­–ç•¥ (1å¤©)**
- ä¸šåŠ¡é¢†åŸŸæ¨¡å¼è¯†åˆ«
- å¸¸è§å®ä½“å…³ç³»æ¨¡æ¿
- ä¸Šä¸‹æ–‡è¯­ä¹‰æ¨æ–­

#### 3.2 æ™ºèƒ½èåˆå¼•æ“ (2å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°ç½®ä¿¡åº¦åŠ æƒç®—æ³•
- [ ] è®¾è®¡å†²çªè§£å†³æœºåˆ¶
- [ ] åˆ›å»ºå…³ç³»éªŒè¯å™¨
- [ ] å®ç°ç»“æœæ’åºå’Œè¿‡æ»¤

**èåˆç®—æ³•**:
```typescript
class IntelligentFusionEngine {
  async fuse(strategyResults: InferenceResult[][]): Promise<Relationship[]> {
    // 1. æŒ‰å…³ç³»åˆ†ç»„
    const relationGroups = this.groupByRelation(strategyResults.flat());
    
    // 2. ç½®ä¿¡åº¦åŠ æƒè®¡ç®—
    const fusedResults = await this.calculateWeightedConfidence(relationGroups);
    
    // 3. å†²çªè§£å†³
    return this.resolveConflicts(fusedResults);
  }
}
```

#### 3.3 ç¼“å­˜å’Œå¢é‡æ›´æ–° (1å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å®ç°LRUç¼“å­˜ç­–ç•¥
- [ ] è®¾è®¡ç¼“å­˜å¤±æ•ˆæœºåˆ¶
- [ ] å®ç°å¢é‡æ¨æ–­ç®—æ³•
- [ ] æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–

### é˜¶æ®µå››ï¼šWebViewç”¨æˆ·ç•Œé¢ (ç¬¬6-7å‘¨)

#### 4.1 åŸºç¡€WebViewæ¡†æ¶ (3å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] åˆ›å»ºWebView Provider
- [ ] å®ç°VS Codeé€šä¿¡æ¡¥æ¥
- [ ] è®¾è®¡HTMLæ¨¡æ¿ç³»ç»Ÿ
- [ ] é…ç½®èµ„æºå®‰å…¨ç­–ç•¥

#### 4.2 å››å±‚ç•Œé¢æ¶æ„å®ç° (5å¤©)

**4.2.1 æ•°æ®ç®¡ç†å±‚ (1å¤©)**
```typescript
class ERDataManager {
  private entities: Map<string, EntityInfo>;
  private relations: Map<string, RelationInfo>;
  
  updateData(newData: ERDiagramData): void;
  getFilteredData(filter: FilterOptions): ERDiagramData;
}
```

**4.2.2 å›¾è¡¨æ¸²æŸ“å±‚ (2å¤©)**
- Mermaid.jsé›†æˆå’Œé…ç½®
- å åŠ å±‚æ¸²æŸ“ç³»ç»Ÿ
- åŠ¨ç”»æ§åˆ¶å™¨
- ä¸»é¢˜ç®¡ç†å™¨

**4.2.3 å¯è§†åŒ–æ§åˆ¶å±‚ (1å¤©)**
- ç¼©æ”¾å’Œå¹³ç§»æ§åˆ¶
- é€‰æ‹©ç®¡ç†å™¨
- é«˜äº®æ§åˆ¶å™¨
- äº¤äº’çŠ¶æ€ç®¡ç†

**4.2.4 ç”¨æˆ·äº¤äº’å±‚ (1å¤©)**
- æ™ºèƒ½å·¥å…·æ ç»„ä»¶
- å³é”®èœå•ç³»ç»Ÿ
- å¿«æ·é”®å¤„ç†
- æœç´¢åŠŸèƒ½

#### 4.3 é«˜çº§UIåŠŸèƒ½ (4å¤©)

**4.3.1 æ™ºèƒ½æœç´¢å’Œè¿‡æ»¤ (1å¤©)**
```typescript
class IntelligentSearch {
  private searchIndex: SearchIndex;
  
  search(query: string): SearchResult[];
  highlightSearchResults(query: string): void;
  createSearchIndex(data: ERDiagramData): SearchIndex;
}
```

**4.3.2 å¯¼å‡ºåŠŸèƒ½ (1å¤©)**
- PNG/SVG/PDFå¯¼å‡º
- è‡ªå®šä¹‰å¯¼å‡ºé€‰é¡¹
- æ‰¹é‡å¯¼å‡ºåŠŸèƒ½

**4.3.3 ä¸»é¢˜ç³»ç»Ÿ (1å¤©)**
- VS Codeä¸»é¢˜é›†æˆ
- è‡ªå®šä¹‰ä¸»é¢˜æ”¯æŒ
- åŠ¨æ€ä¸»é¢˜åˆ‡æ¢

**4.3.4 å“åº”å¼å¸ƒå±€ (1å¤©)**
- ç§»åŠ¨ç«¯é€‚é…
- ä¸åŒå±å¹•å°ºå¯¸æ”¯æŒ
- å¯æŠ˜å é¢æ¿

### é˜¶æ®µäº”ï¼šæ€§èƒ½ä¼˜åŒ–å’Œæµ‹è¯• (ç¬¬8å‘¨)

#### 5.1 æ€§èƒ½ä¼˜åŒ– (3å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] è™šæ‹ŸåŒ–å¤§å‹å›¾è¡¨æ¸²æŸ“
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] å¹¶è¡Œå¤„ç†ä¼˜åŒ–
- [ ] ç¼“å­˜ç­–ç•¥è°ƒä¼˜

#### 5.2 æµ‹è¯•å’Œè´¨é‡ä¿è¯ (3å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆæµ‹è¯•å¥—ä»¶
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•

#### 5.3 æ–‡æ¡£å’Œå‘å¸ƒå‡†å¤‡ (1å¤©)
**ä»»åŠ¡åˆ—è¡¨**:
- [ ] ç”¨æˆ·æ–‡æ¡£ç¼–å†™
- [ ] APIæ–‡æ¡£ç”Ÿæˆ
- [ ] VS Code Marketplaceå‡†å¤‡
- [ ] å‘å¸ƒæµç¨‹æµ‹è¯•

## ğŸ”§ æŠ€æœ¯å®ç°è¦ç‚¹

### æ ¸å¿ƒä¾èµ–åŒ…
```json
{
  "dependencies": {
    "vscode": "^1.74.0",
    "mermaid": "^9.4.0",
    "fast-xml-parser": "^4.0.0",
    "typescript": "^4.9.0"
  },
  "devDependencies": {
    "webpack": "^5.75.0",
    "esbuild-loader": "^2.20.0",
    "@types/vscode": "^1.74.0"
  }
}
```

### é¡¹ç›®é…ç½®æ–‡ä»¶

#### package.json (VS Codeæ‰©å±•é…ç½®)
```json
{
  "name": "mybatis-er-generator",
  "displayName": "MyBatis ER Generator",
  "description": "Generate ER diagrams for MyBatis projects",
  "version": "1.0.0",
  "engines": {
    "vscode": "^1.74.0"
  },
  "categories": ["Other"],
  "activationEvents": [
    "onLanguage:java",
    "onLanguage:xml"
  ],
  "main": "./out/extension.js",
  "contributes": {
    "commands": [
      {
        "command": "mybatis-er.generate",
        "title": "ç”Ÿæˆ MyBatis ER å›¾",
        "category": "MyBatis ER"
      }
    ],
    "menus": {
      "explorer/context": [
        {
          "command": "mybatis-er.generate",
          "when": "explorerResourceIsFolder"
        }
      ]
    }
  }
}
```

## ğŸ“Š è´¨é‡æŒ‡æ ‡å’ŒéªŒæ”¶æ ‡å‡†

### åŠŸèƒ½æŒ‡æ ‡
- [ ] æ”¯æŒMyBatis-Pluså…¨éƒ¨ä¸»æµæ³¨è§£ (100%)
- [ ] å®ä½“è¯†åˆ«å‡†ç¡®ç‡ â‰¥ 90%
- [ ] å…³ç³»æ¨æ–­å‡†ç¡®ç‡ â‰¥ 80%
- [ ] Mermaidæ ¼å¼è¾“å‡ºæ­£ç¡®ç‡ â‰¥ 95%

### æ€§èƒ½æŒ‡æ ‡
- [ ] 1000+å®ä½“é¡¹ç›®æ‰«ææ—¶é—´ < 10ç§’
- [ ] å¢é‡æ›´æ–°å“åº”æ—¶é—´ < 1ç§’
- [ ] å†…å­˜å ç”¨ < 100MB
- [ ] VS Codeå¯åŠ¨æ—¶é—´å¢åŠ  < 500ms

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- [ ] ç•Œé¢æ“ä½œå“åº”æ—¶é—´ < 100ms
- [ ] é”™è¯¯æ¢å¤èƒ½åŠ› â‰¥ 95%
- [ ] è·¨å¹³å°å…¼å®¹æ€§ (Windows/Mac/Linux)
- [ ] å¯è®¿é—®æ€§æ”¯æŒ

## ğŸ¯ é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹

| é˜¶æ®µ | æ—¶é—´ç‚¹ | å…³é”®è¾“å‡º | éªŒæ”¶æ ‡å‡† |
|------|--------|----------|----------|
| **MVP** | ç¬¬2å‘¨ç»“æŸ | åŸºç¡€æ‰«æ+ç®€å•ERå›¾ | èƒ½ç”ŸæˆåŸºæœ¬çš„å®ä½“å…³ç³»å›¾ |
| **Alpha** | ç¬¬4å‘¨ç»“æŸ | å®Œæ•´è§£æå¼•æ“ | æ”¯æŒå¤æ‚é¡¹ç›®è§£æ |
| **Beta** | ç¬¬6å‘¨ç»“æŸ | å®Œæ•´UIç•Œé¢ | ç”¨æˆ·ä½“éªŒåŸºæœ¬å®Œå¤‡ |
| **RC** | ç¬¬7å‘¨ç»“æŸ | æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬ | è¾¾åˆ°æ‰€æœ‰æ€§èƒ½æŒ‡æ ‡ |
| **Release** | ç¬¬8å‘¨ç»“æŸ | å‘å¸ƒå°±ç»ªç‰ˆæœ¬ | é€šè¿‡å…¨éƒ¨æµ‹è¯• |

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³å¼€å§‹**: é¡¹ç›®åˆå§‹åŒ–å’Œæ¡†æ¶æ­å»º
2. **å¹¶è¡Œå¼€å‘**: è§£æå™¨å’ŒUIå¯ä»¥å¹¶è¡Œå¼€å‘
3. **è¿­ä»£ä¼˜åŒ–**: æ¯ä¸ªé˜¶æ®µéƒ½è¿›è¡Œç”¨æˆ·åé¦ˆæ”¶é›†
4. **æŒç»­é›†æˆ**: å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»ºæµç¨‹

---

**çŠ¶æ€**: ğŸ“‹ ç­‰å¾…å®ç°å¼€å§‹
**é¢„è®¡å®Œæˆæ—¶é—´**: 8å‘¨ (åŸºäºè¯¦ç»†ä»»åŠ¡åˆ†è§£)
**é£é™©ç­‰çº§**: ğŸŸ¡ ä¸­ç­‰ (å·²é€šè¿‡åˆ›æ„è®¾è®¡éªŒè¯å¯è¡Œæ€§) 